---
import Layout from "../layouts/Layout.astro";
import { sendEmail } from "../scripts/mailer";

// Désactiver le pré-rendu pour permettre l'accès aux en-têtes de requête
export const prerender = false;

let errors = { firstName: "", lastName: "", email: "", tel: "", message: "" };
if (Astro.request.method === "POST") {
	errors = { firstName: "", lastName: "", email: "", tel: "", message: "" };
	try {
		const data = await Astro.request.formData();
		const firstName = data.get("first-name")?.toString() || "";
		const lastName = data.get("last-name")?.toString() || "";
		const email = data.get("email")?.toString() || "";
		const tel = data.get("tel")?.toString() || "";
		const message = data.get("message")?.toString() || "";

		// Validation
		if (!firstName.trim()) errors.firstName = "Le prénom est requis";
		if (!lastName.trim()) errors.lastName = "Le nom est requis";
		if (!email.trim()) errors.email = "L'email est requis";
		if (!message.trim()) errors.message = "Le message est requis";

		// Validation logic
		const hasErrors = Object.values(errors).some((msg) => msg);
		if (!hasErrors) {
			const fullName = `${firstName} ${lastName}`;
			const payload = {
				name: fullName,
				email: email,
				tel: tel,
				html: message,
				subject: `Nouveau message de contact de ${fullName}`,
			};
			await sendEmail(payload);
		}
	} catch (error) {
		if (error instanceof Error) {
			console.error(error.message);
		}
	}
}
---

<Layout title="A Propos - Florine Talon Avocat" description="Parcours de Florine Talon, avocate en droit pénal à Amiens et sur le territoire national. Droit pénal, assistance de victimes, personnes mises en cause, infractions pénales et routières.">
	<div class="sticky top-0 flex h-96 bg-slate-900 bg-cover bg-center" style="background-image: url('/img/palais-4.jpg');" aria-label="Palais de justice d'Amiens">
		<!-- <div class="max-w-screen-3xl mx-auto my-auto w-full">
			<div class="mx-auto w-11/12 md:ml-10 md:w-fit">
			<div class="mt-16 ml-4">
					<h1 class="font-second text-aqua-500 overflow-hidden text-6xl italic"><span class="loading-appear inline-block">A PROPOS</span></h1>
					<hr class="border-aqua-500 w-64" />
				</div> 
			</div>
		</div>-->
	</div>
	<main class="relative bg-white py-8">
		<!-- <Parcours /> -->

		<section class="m-auto max-w-4xl">
			<h2 class="font-second mt-4 mb-4 w-fit px-4 text-4xl font-light tracking-tight italic md:mt-0 md:mb-12 md:text-6xl" style="background: linear-gradient(to bottom, transparent 50%, #aafee2 50%);">ME CONTACTER</h2>
			<div>
				<form class="w-full" method="POST" enctype="application/x-www-form-urlencoded">
					<div class="-mx-3 mb-6 flex flex-wrap">
						<div class="mb-6 w-full px-3 md:mb-0 md:w-1/2">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="first-name">Prénom</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="first-name" name="first-name" type="text" placeholder="Prénom" required />
							{errors.firstName && <p class="mt-1 text-xs text-red-500 italic">{errors.firstName}</p>}
						</div>
						<div class="w-full px-3 md:w-1/2">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="last-name">Nom</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="last-name" name="last-name" type="text" placeholder="Nom" required />
							{errors.lastName && <p class="mt-1 text-xs text-red-500 italic">{errors.lastName}</p>}
						</div>
					</div>
					<div class="-mx-3 mb-6 flex flex-wrap">
						<div class="mb-6 w-full px-3 md:mb-0 md:w-1/2">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="email">Mail</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" name="email" type="email" placeholder="Mail" required />
							{errors.email && <p class="mt-1 text-xs text-red-500 italic">{errors.email}</p>}
						</div>
						<div class="w-full px-3 md:w-1/2">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="tel">Tel</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="tel" name="tel" type="tel" placeholder="Tel" />
						</div>
					</div>
					<div class="-mx-3 mb-2 flex flex-wrap">
						<div class="w-full px-3">
							<label for="message" class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase">Mon message</label>
							<textarea id="message" name="message" rows="4" class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" placeholder="Mon message..." required></textarea>
							{errors.message && <p class="mt-1 text-xs text-red-500 italic">{errors.message}</p>}
						</div>
					</div>
					<button type="submit" class="bg-aqua-500 hover:bg-aqua-700 mt-4 w-full rounded-lg px-5 py-3 text-center text-lg font-medium italic transition-colors duration-200 hover:text-white focus:ring-4 focus:ring-blue-300 focus:outline-none sm:w-auto">Submit</button>
					<!-- bg-aqua-500 hover:bg-aqua-700 mt-4 rounded-lg px-5 py-3 text-lg transition-colors duration-200 hover:text-white -->
					<!-- <div class="-mx-3 mb-2 flex flex-wrap">
						<div class="mb-6 w-full px-3 md:mb-0 md:w-1/3">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="city">City</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="city" type="text" placeholder="Albuquerque" />
						</div>
						<div class="mb-6 w-full px-3 md:mb-0 md:w-1/3">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="state">State</label>
							<div class="relative">
								<select class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 pr-8 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="state">
									<option>New Mexico</option>
									<option>Missouri</option>
									<option>Texas</option>
								</select>
								<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
									<svg class="h-4 w-4 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path></svg>
								</div>
							</div>
						</div>
						<div class="mb-6 w-full px-3 md:mb-0 md:w-1/3">
							<label class="mb-2 block text-xs font-bold tracking-wide text-gray-700 uppercase" for="zip">Zip</label>
							<input class="block w-full appearance-none rounded border border-gray-200 bg-gray-200 px-4 py-3 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="zip" type="text" placeholder="90210" />
						</div>
					</div> -->
				</form>
			</div>
		</section>
	</main>
	<!-- <Reviews /> -->
	<!-- <hr class="my-8 border-t border-gray-200" /> -->
</Layout>
